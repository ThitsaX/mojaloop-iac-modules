apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - namespaces.yaml
  - zitadel-cert-job.yaml
  - zitadel-random-secrets.yaml
  - vitrual-services.yaml
  - zitadel-xplane-terraform.yaml

helmCharts:

  - name: cockroachdb
    releaseName: zitadel-db
    version: {{ cockroachdb_helm_version }}
    repo: https://charts.cockroachdb.com/
    valuesFile: cockroach-db-values.yaml
    namespace: {{ zitadel_namespace }}

  - name: zitadel
    releaseName: zitadel
    version: {{ zitadel_helm_version }}
    repo: https://charts.zitadel.com
    valuesFile: zitadel-values.yaml
    namespace: {{ zitadel_namespace }}

patches:
  - target:
      kind: CronJob
    patch: |
      - op: replace
        path: /apiVersion
        value: batch/v1